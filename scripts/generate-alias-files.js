// Generates 'alias'.js|ts files until they can be generated and added to ext-react module.
// These are used to import plugins, layouts, proxies, etc instead of 
const path = require('path');
const fs = require('fs');

let aliases = ["request.ajax","request.form","widget.widget","easing.linear","translatable.dom","translatable.cssposition","translatable.csstransform","translatable.scrollposition","scroller.scroller","widget.component","widget.progress","widget.progressbarwidget","animation.slide","animation.slideIn","animation.slideOut","animation.fade","animation.fadeIn","animation.fadeOut","animation.flip","animation.pop","animation.popIn","animation.popOut","namer.default","schema.default","data.operation.create","data.operation.destroy","data.operation.read","data.operation.update","data.validator.base","data.field.auto","data.field.bool","data.field.boolean","data.field.date","data.field.int","data.field.integer","data.field.float","data.field.number","data.field.string","data.identifier.default","data.identifier.sequential","reader.base","writer.base","proxy.proxy","proxy.memory","proxy.server","proxy.ajax","reader.json","writer.json","store.store","reader.array","store.array","widget.container","layout.default","layout.auto","widget.indicator","layout.card.fx.abstract","layout.card.fx.cover","layout.card.fx.cube","layout.card.fx.fade","layout.card.fx.flip","layout.card.fx.pop","layout.card.fx.reveal","layout.card.fx.scroll","layout.card.fx.scrollcover","layout.card.fx.scrollreveal","layout.card.fx.slide","layout.card","widget.viewport","controller.controller","store.chained","viewmodel.default","store.node","store.tree","reader.xml","proxy.rest","data.summary.base","data.summary.sum","data.summary.average","data.summary.max","data.validator.number","data.validator.date","data.validator.presence","drag.constraint.base","drag.proxy.none","drag.proxy.original","drag.proxy.placeholder","animation.cube","easing.ease-out","widget.treelistitem","widget.treelist","plugin.mouseenter","widget.sparkline","widget.sparklineline","widget.tool","widget.paneltool","layout.box","widget.button","widget.title","widget.spacer","widget.toolbar","widget.panel","widget.mask","widget.sheet","widget.actionsheet","widget.media","widget.audio","widget.dialog","widget.window","widget.field","widget.inputfield","trigger.base","trigger.trigger","widget.trigger","trigger.clear","widget.cleartrigger","widget.textfield","widget.editor","widget.image","widget.img","widget.label","widget.loadmask","widget.textareafield","layout.vbox","widget.messagebox","widget.segmentedbutton","widget.titlebar","widget.video","widget.carousel","navmodel.dataview","selection.rows","selection.records","selmodel.dataview","widget.emptytext","widget.dataitem","widget.componentdataview","widget.itemheader","widget.simplelistitem","widget.list","navmodel.boundlist","widget.boundlist","widget.dataview","widget.indexbar","widget.listitem","layout.hbox","widget.nestedlist","widget.listswiperitem","widget.listswiperaccordion","plugin.listswiper","widget.listswiperstepper","widget.tooltip","plugin.listpaging","plugin.sortablelist","widget.pullrefreshbar","plugin.pullrefresh","widget.pullrefreshspinner","widget.checkbox","widget.checkboxfield","trigger.expand","widget.expandtrigger","widget.pickerfield","widget.pickerslot","widget.picker","widget.tabletpicker","widget.selectfield","widget.combobox","widget.comboboxfield","widget.containerfield","widget.fieldcontainer","trigger.date","widget.datetrigger","widget.datepicker","layout.carousel","widget.dateview","widget.paneltitle","widget.datetitle","widget.yearpicker","widget.datepanel","widget.datefield","widget.datepickerfield","widget.emailfield","widget.filefield","widget.filebutton","widget.hiddenfield","widget.numberfield","widget.fieldpanel","trigger.reveal","widget.revealtrigger","widget.passwordfield","widget.radio","widget.radiofield","trigger.search","widget.searchtrigger","widget.searchfield","widget.thumb","widget.slider","widget.sliderfield","widget.singlesliderfield","trigger.spindown","widget.spindowntrigger","trigger.spinup","widget.spinuptrigger","widget.spinnerfield","widget.toggleslider","widget.togglefield","widget.urlfield","trigger.component","trigger.file","widget.fieldset","widget.formpanel","widget.celleditor","navmodel.grid","widget.gridcellbase","widget.textcell","widget.gridcell","widget.rowbody","widget.gridrow","widget.headercontainer","widget.menuitem","widget.menucheckitem","widget.gridcolumn","widget.column","widget.templatecolumn","widget.datecell","widget.datecolumn","widget.gridcolumnsmenu","widget.gridgroupbythismenuitem","widget.gridshowingroupsmenuitem","widget.menuradioitem","widget.gridsortascmenuitem","widget.gridsortdescmenuitem","selection.cells","selection.columns","plugin.selectionreplicator","widget.numbercell","widget.checkcell","widget.checkcolumn","widget.selectioncolumn","widget.numbercolumn","widget.rownumberercell","widget.rownumberer","selmodel.grid","plugin.columnresizing","plugin.gridcolumnresizing","widget.rowheader","widget.menu","widget.grid","widget.pagingtoolbar","widget.gridsummaryrow","widget.expandercell","widget.widgetcell","widget.textcolumn","plugin.gridcellediting","plugin.cellediting","plugin.clipboard","plugin.grideditable","plugin.pagingtoolbar","plugin.gridpagingtoolbar","plugin.rowexpander","plugin.rowoperations","plugin.multiselection","plugin.gridmultiselection","plugin.gridsummary","plugin.summaryrow","plugin.gridsummaryrow","widget.viewoptionslistitem","layout.fit","plugin.gridviewoptions","layout.center","layout.form","layout.overflow.scroller","widget.menuseparator","widget.panelheader","plugin.responsive","widget.tab","widget.tabbar","widget.tabpanel","widget.calendar-event","widget.calendar-list","drag.proxy.calendar-weeks","drag.proxy.calendar-days","widget.calendar-calendar-picker","widget.calendar-timefield","widget.calendar-form-add","widget.calendar-form-edit","widget.calendar-daysheader","widget.calendar-weeksheader","store.calendar-events","store.calendar-calendars","widget.calendar-daysview","widget.calendar-days","widget.calendar-dayview","widget.calendar-day","widget.calendar-weeksview","widget.calendar-weeks","widget.calendar-monthview","widget.calendar-month","widget.calendar-weekview","widget.calendar-week","widget.calendar-multiview","widget.calendar","modifier.target","modifier.animation","modifier.highlight","sprite.sprite","sprite.path","Ext.draw.Sprite","sprite.circle","sprite.arc","sprite.arrow","sprite.composite","sprite.cross","sprite.diamond","sprite.ellipse","sprite.ellipticalArc","sprite.rect","sprite.image","sprite.instancing","sprite.line","sprite.plus","sprite.sector","sprite.square","sprite.text","sprite.tick","sprite.triangle","gradient.linear","gradient.radial","widget.surface","widget.draw","chart.theme.default","chart.theme.Default","chart.theme.Base","widget.interaction","sprite.axis","segmenter.names","segmenter.numeric","segmenter.time","axisLayout.discrete","axisLayout.combineByIndex","axisLayout.combineDuplicate","axisLayout.continuous","widget.axis","legend.dom","widget.legend","sprite.legenditem","sprite.legendborder","legend.sprite","grid.horizontal","grid.vertical","widget.cartesian","widget.chart","grid.circular","grid.radial","widget.polar","widget.spacefilling","sprite.axis3d","widget.axis3d","axis.category","axis.category3d","axis.numeric","axis.radial","axis.numeric3d","axis.time","axis.time3d","grid.horizontal3d","grid.vertical3d","interaction.crosszoom","interaction.crosshair","interaction.itemhighlight","interaction.itemedit","interaction.panzoom","interaction.rotate","interaction.rotatePie3d","sprite.rangemask","widget.chartnavigator","plugin.chartitemevents","sprite.areaSeries","series.area","sprite.barSeries","series.bar","sprite.bar3dSeries","sprite.bar3d","series.bar3d","sprite.boxplotSeries","sprite.boxplot","series.boxplot","sprite.candlestickSeries","series.candlestick","series.gauge","sprite.lineSeries","series.line","sprite.pieslice","series.pie","sprite.pie3dPart","series.pie3d","sprite.radar","series.radar","sprite.scatterSeries","series.scatter","chart.theme.blue","chart.theme.Blue","chart.theme.blue-gradients","chart.theme.Blue:gradients","chart.theme.category1","chart.theme.Category1","chart.theme.category1-gradients","chart.theme.Category1:gradients","chart.theme.category2","chart.theme.Category2","chart.theme.category2-gradients","chart.theme.Category2:gradients","chart.theme.category3","chart.theme.Category3","chart.theme.category3-gradients","chart.theme.Category3:gradients","chart.theme.category4","chart.theme.Category4","chart.theme.category4-gradients","chart.theme.Category4:gradients","chart.theme.category5","chart.theme.Category5","chart.theme.category5-gradients","chart.theme.Category5:gradients","chart.theme.category6","chart.theme.Category6","chart.theme.category6-gradients","chart.theme.Category6:gradients","chart.theme.default-gradients","chart.theme.Base:gradients","chart.theme.green","chart.theme.Green","chart.theme.green-gradients","chart.theme.Green:gradients","chart.theme.midnight","chart.theme.Midnight","chart.theme.muted","chart.theme.Muted","chart.theme.purple","chart.theme.Purple","chart.theme.purple-gradients","chart.theme.Purple:gradients","chart.theme.red","chart.theme.Red","chart.theme.red-gradients","chart.theme.Red:gradients","chart.theme.sky","chart.theme.Sky","chart.theme.sky-gradients","chart.theme.Sky:gradients","chart.theme.yellow","chart.theme.Yellow","chart.theme.yellow-gradients","chart.theme.Yellow:gradients","interaction.iteminfo","widget.d3-svg","widget.d3","widget.d3-heatmap","widget.d3-pack","widget.d3-treemap","widget.d3-partition","widget.d3-sunburst","widget.d3-tree","widget.d3-horizontal-tree","d3.interaction.panzoom","exporter.base","ooxmltheme.base","ooxmltheme.office","exporter.excel07","exporter.xlsx","exporter.excel","plugin.exporterplugin","exporter.excel03","exporter.csv","exporter.html","exporter.tsv","plugin.gridexporter","exporter.pivotxlsx","pivotfilter.base","pivotfilter.label","pivotfilter.value","pivotaxis.base","pivotaxis.local","pivotresult.base","pivotmatrix.base","pivotresult.local",
"pivotmatrix.local","pivotmatrix.remote","plugin.pivotexporter","plugin.mzexcelexport","pivotupdate.base","pivotupdate.increment","pivotupdate.overwrite","pivotupdate.percentage","pivotupdate.uniform","widget.pivotgridcell","widget.pivotgridgroupcell","widget.pivotgridrow","widget.pivotgrid","widget.pivotconfigfield","widget.pivotconfigcontainer","controller.pivotconfigpanel","store.pivotselect","controller.pivotconfigform","widget.pivotconfigform","controller.pivotsettings","widget.pivotsettings","widget.pivotconfigpanel","plugin.pivotconfigurator","plugin.pivotdrilldown","controller.pivotrangeeditor","widget.pivotrangeeditor","plugin.pivotrangeeditor","widget.pivotheatmap","widget.pivottreemap","widget.pivotd3container","widget.renderercell","widget.transition","widget.tree","widget.treecell","widget.treecolumn","widget.gauge","simlet.basic","simlet.json","widget.rating","reader.salary"];
const validAliases = ['animation', 'axis', 'axisLayout', 'drag', 'exporter', 'grid', 'interaction', 'layout', 'legend', 'modifier', 'namer', 'plugin', 'proxy', 'reader', 'request', 'segmenter', 'selection', 'selmodel', 'series', 'sprite', 'store', 'trigger', 'writer'];
const validDataAliases = ['field', 'validator', 'operation', 'summary'];
aliases = aliases.filter(a => {
    const aliasSplit = a.split('.');
    return aliasSplit[0] === 'data' ? validDataAliases.indexOf(aliasSplit[1]) >= 0 : validAliases.indexOf(aliasSplit[0]) >= 0; 
});

// Special handling for 'data' aliases.
const dataAliasDefinitions = {};

const aliasDefinitions = aliases.reduce((res, a) => {
    const aSplit = a.split('.');
    const aliasType = aSplit[0];
    const aliasName = aSplit[1];

    // Exclude 'default' component aliases.
    if(aliasName === 'default') return res;

    if(aliasType === 'data') {
        dataAliasDefinitions[aSplit[1]] = dataAliasDefinitions[aSplit[1]] || new Set();
        dataAliasDefinitions[aSplit[1]].add(`export const ${aSplit[2].replace(/-/g, '_')} = '${aSplit[2]}';`);
    } else {
        res[aliasType] = res[aliasType] || new Set();
        res[aliasType].add(`export const ${aliasName.replace(/-/g, '_')} = '${aliasName}';`);
    }

    return res;
}, {});

console.log(dataAliasDefinitions);

const packagesDir = path.resolve(__dirname, '..', 'packages');
fs.readdirSync(packagesDir).forEach(dir => {
    const extReactNMDir = path.join(packagesDir, dir, 'node_modules', '@extjs', 'ext-react');
    
    try {
        if(!fs.statSync(extReactNMDir).isDirectory()) return;
    } catch(e) { return; }

    Object.keys(aliasDefinitions).forEach(aliasType => {
        // const aliasPlural = inflection.pluralize(aliasType);
        const fileContents = Array.from(aliasDefinitions[aliasType]).join('\n');
        const filePath = path.join(extReactNMDir, aliasType);
        console.log('Writing file: ', filePath);
        fs.writeFileSync(`${filePath}.js`, fileContents);
        fs.writeFileSync(`${filePath}.ts`, fileContents);
    });

    try { fs.mkdirSync(path.join(extReactNMDir, 'data')); } catch(e) {}

    Object.keys(dataAliasDefinitions).forEach(aliasType => {
        // const aliasPlural = inflection.pluralize(aliasType);
        const fileContents = Array.from(dataAliasDefinitions[aliasType]).join('\n');
        const filePath = path.join(extReactNMDir, 'data', aliasType);
        console.log('Writing file: ', filePath);
        fs.writeFileSync(`${filePath}.js`, fileContents);
        fs.writeFileSync(`${filePath}.ts`, fileContents);
    });
});